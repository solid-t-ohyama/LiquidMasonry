(()=>{"use strict";const t=function(){function t(t){var i=this;if(this.defaults={containerSelector:".masonry",itemSelector:".items",brakePoints:[],brakeTargetSelector:"window",gapMin:10,gapMax:30,initialStyle:!0,debug:!1},this.cardSetting=null,this.breakWidth=0,this.containerWidth=0,this.cardWidths=[],this.grid=0,this.gapV=0,this.gapH=0,this.debug=!1,this.options=Object.assign(this.defaults,t),this.container=document.querySelector(this.options.containerSelector),!this.container)throw new Error("container is not found");this.items=document.querySelectorAll(this.options.itemSelector),"window"===this.options.brakeTargetSelector?this.brakeTarget=window:this.brakeTarget=document.querySelector(this.options.brakeTargetSelector),this.brakeTarget||(this.brakeTarget=window),this.debug=this.options.debug,this.sortBrakePoints(),this.init(),this.display(),document.addEventListener("DOMContentLoaded",(function(t){i.update()})),this.monitorImageLoad(),this.monitorItemResize(),this.container.classList.add("masonry-initialized")}return t.prototype.init=function(){this.setContainerWidth(),this.setBrakePointSettings(),this.setCardSizes()},t.prototype.update=function(){this.setContainerWidth(),this.setBrakePointSettings(),this.setCardSizes(),this.display()},t.prototype.monitorImageLoad=function(){for(var t=this,i=this.container.getElementsByTagName("img"),e=0;e<i.length;e++){var n=i[e];n.complete?this.update():n.addEventListener("load",(function(i){t.update()}))}},t.prototype.monitorItemResize=function(){var t=this,i=new ResizeObserver((function(i){for(var e=0,n=i;e<n.length;e++){var o=n[e];t.debug&&console.log("resize",o.target)}t.update()}));i.observe(this.container),this.items.forEach((function(t,e){i.observe(t)}))},t.prototype.sortBrakePoints=function(){this.options.brakePoints.sort((function(t,i){return t.brakePoint<i.brakePoint?-1:t.brakePoint>i.brakePoint?1:0})),this.debug&&console.log("brakePoints",this.options.brakePoints)},t.prototype.setContainerWidth=function(){this.containerWidth=this.container.clientWidth,this.debug&&console.log("containerWidth",this.containerWidth)},t.prototype.setBrakeWidth=function(){this.brakeTarget instanceof Window?this.breakWidth=window.innerWidth:this.breakWidth=this.brakeTarget.clientWidth,this.debug&&console.log("breakWidth",this.containerWidth)},t.prototype.setBrakePointSettings=function(){var t=this;this.setBrakeWidth();var i=!1;this.options.brakePoints.forEach((function(e,n){if(t.debug&&console.log("cardSetting check",[t.breakWidth,e.brakePoint]),t.breakWidth>e.brakePoint)return t.cardSetting=e,void(i=!0)})),i||(this.cardSetting=null),this.debug&&console.log("cardSetting",this.cardSetting)},t.prototype.setCardSizes=function(){var t,i,e;if(null===this.cardSetting)return this.grid=0,this.gapV=0,void(this.gapH=0);var n=null!==(t=this.cardSetting.gapRatioX)&&void 0!==t?t:.01,o=null!==(i=this.cardSetting.gapRatioY)&&void 0!==i?i:.01,s=0;if("object"==typeof this.cardSetting.grid){var a=this.cardSetting.grid,r=this.calculateMasonryLayout(a.itemMinWidth,a.itemMaxWidth,n,this.options.gapMin,this.options.gapMax);if(null===r)return void(this.cardSetting=null);this.grid=r.grid,this.gapH=r.margin,s=r.itemWidth}else this.grid=null!==(e=this.cardSetting.grid)&&void 0!==e?e:1,this.gapH=this.breakWidth*o,this.gapH=Math.min(Math.max(this.gapH,this.options.gapMin),this.options.gapMax),s=(this.containerWidth-this.gapH*(this.grid-1))/this.grid;this.gapV=this.breakWidth*n,this.gapV=Math.min(Math.max(this.gapV,this.options.gapMin),this.options.gapMax),this.cardWidths=[];for(var h=0;h<this.grid;h++){var d=s*(h+1)+this.gapH*h;this.cardWidths.push(d)}this.debug&&console.log("gap",{x:this.gapH,y:this.gapV}),this.debug&&console.log("cardWidths",this.cardWidths)},t.prototype.display=function(){var t,i=this;if(null!==this.cardSetting){this.initialStyle();var e=this.grid,n=null!==(t=this.cardWidths[0])&&void 0!==t?t:0,o=Array(e).fill(0);this.items.forEach((function(t,n){var o=t.dataset.colWidth?Number(t.dataset.colWidth):1;o>e&&(o=e),o<=0&&(o=1),t.style.width=i.cardWidths[o-1]+"px"})),this.items.forEach((function(t,s){if(null!==i.cardSetting){var a=t.dataset.colWidth?Number(t.dataset.colWidth):1;a>e&&(a=e),a<=0&&(a=1);var r=i.getMultiMinIndex(o,a),h=r[0],d=r[1],c=(n+i.gapH)*h;t.style.left=c+"px",t.style.top=d+"px";for(var l=0;l<a;l++)o[h+l]=d+t.clientHeight+i.gapV}})),this.container.style.height=Math.max.apply(Math,o)+"px"}else this.resetStyle()},t.prototype.initialStyle=function(){this.options.initialStyle&&(this.container.style.position="relative",this.items.forEach((function(t,i){t.style.position="absolute"})))},t.prototype.resetStyle=function(){var t=this;this.container.style.height="",this.options.initialStyle&&(this.container.style.position=""),this.items.forEach((function(i,e){t.cardReset(i),t.options.initialStyle&&(i.style.position="")}))},t.prototype.cardReset=function(t){t.style.width="",t.style.left="",t.style.top=""},t.prototype.getMultiMinIndex=function(t,i){for(var e=0,n=Math.max.apply(Math,t.slice(0,i)),o=1;o<=t.length-i;o++){var s=Math.max.apply(Math,t.slice(o,o+i));s<n&&(e=o,n=s)}return[e,n]},t.prototype.calculateMasonryLayout=function(t,i,e,n,o){if(this.containerWidth<t&&(t=this.containerWidth),this.containerWidth<1)return null;var s=Math.floor(this.containerWidth/t);s<1&&(s=1);var a=this.containerWidth*e;a=Math.min(Math.max(a,n),o);for(var r=(this.containerWidth-a*(s-1))/s;r>i&&s<this.containerWidth/t;)s++,r=(this.containerWidth-a*(s-1))/s;for(;r<t&&s>1;)s--,r=(this.containerWidth-a*(s-1))/s;return r>i?r=i:r<t&&(r=t),r*s+a*(s-1)<this.containerWidth&&(a=(this.containerWidth-r*s)/(s-1)),this.debug&&console.log("calculateMasonryLayout",{grid:s,itemWidth:r,margin:a}),{grid:s,itemWidth:r,margin:a}},t}();document.addEventListener("DOMContentLoaded",(function(){window.LiquidMasonry=t}))})();